# Project Notes

## Tasks

- C++ 风格指南
	- [Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html)
	- [Google C++ 风格指南 - 内容目录](https://zh-google-styleguide.readthedocs.io/en/latest/google-cpp-styleguide/contents.html)
- Spdlog 日志库：[spdlog](https://github.com/gabime/spdlog)
	- 掌握 spdlog，学习 spdlog 日志库的使用，简单看看 spdlog 的源码。
	- 了解如何集成 spdlog。
	- 自己写个小 demo，可通过 spdlog 打印不同级别的日志。
	- 了解 spdlog 基本功能的代码实现。
	- 了解 spdlog 的设计架构。
	- 自己画出 spdlog 的架构设计图。
 - 了解常见日志系统的架构，掌握日志系统的架构
	- 理解每个模块的作用。
	- 理解各个模块间如何组合协调工作。
	- 自己总结一下日志系统的结构，自己画个相关的架构图。
 - 掌握高性能日志系统的代码结构
	- 了解项目都有那些模块。
	- 了解每个模块的作用。
- 学习、掌握 CMake 的使用。
	- 如果有多个系统，可以练习通过 CMake 构建 Windows、Linux、macOS 的 demo，并能成功运行。
- 学习 Git 的使用
	- 了解 git 的作用。
	- 掌握 git 基本命令的作用以及使用方式：`git init`，`git add`，`git commit`，`git merge`，`git rebase`，`git push`。
	- 在 git 管理端创建一个项目，并把本地代码推送到 git 管理端。
- 了解 vcpkg 的使用：[vcpkg](https://github.com/microsoft/vcpkg)
	- 了解 vcpkg 的作用以及使用。
	- 安装 vcpkg。
	- 通过 vcpkg 安装一些三方库，比如 `openssl`，`zlib`，`zstd`。
	- 通过 CMake 集成 vcpkg 安装的库。
- 封装 mmap 模块，让文件 I/O 项操作内存一样方便。
	- 了解 mmap 的作用和优势。
	- 了解 mmap 的原理。
	- 封装 mmap 模块，将其封装成类似 vector 一样可以动态扩容的动态数组，功能类似于 vector。
- 了解 defer 机制、RAII 的巧妙应用。
	- 掌握 defer 功能的优势。
	- 掌握 defer 的原理。
	- 封装 defer 模块。
- 理解如何自定义 space 类：解决空间单位不一致的 bug。
	- 掌握 chrono 的基本使用。
	- 掌握 std::ratio 的原理。
	- 实现一个 space 模板类，不同的空间单位可以灵活转换。
- 了解单元测试：[googletest](https://github.com/google/googletest)
	- 了解单元测试的作用。
	- 了解 C++ 都有哪些常见的单元测试库。
	- 了解 googletest 的作用、常见能力以及如何使用。
	- 通过 vcpkg 集成 googletest。
- 了解 fmt 的作用以及基本使用（弃用 cout 和 printf）。
	- 了解 fmt 的作用。
 	- 写一个 Demo，集成 fmt，灵活使用 fmt 打印一些信息，掌握 fmt 的基本使用。
- 理解日志消息的数据结构和生命周期（核心结构体：LogMsg）。
	- 分析 `log_msg.h` 和 `log_msg.cc`。
	- 了解日志消息的创建和传递机制。
	- 掌握日志消息的内存管理策略。
- 集成 fmt 到项目中（系统内部也需要打印日志：internal_log）。
	- 封装 fmt 作为内部的日志模块。
	- 内部的日志模块可打印不同界别的日志，携带上文件名和行号等。
- 学习如何是并发编程更方便易用（线程池、Strand 机制：并发任务调度器 Executor、Context：日志系统任务管理器）
	- 自己实现一个线程池。
	- 基于线程池实现一个定时器。
	- 了解 strand 机制。
	- 基于线程池封装 strand 模块。
	- 封装整个系统的任务管理器 Context。
	- 系统内的所有并发任务都通过 Context 调度。
- 研究 [系统](https://git.cpptrain.top/logger/logger-tutorial/-/blob/main/example/logger_example.cc?ref_type=heads) 的 example。
	- 了解本日志系统的对外 API。
	- 了解如何使用本日志系统。
	- 了解 LogHandle。
	- 了解 Sink。
	- 了解 LogLevel。
	- 了解 Flush。
	- 了解 Log 接口。
- 了解系统整体框架搭建；日志处理接口定义了系统的对外 API，是用户与系统交互的主要方式。
	- 学习 `log_handle.h` 和 `log_factory.cc`。
	- 了解日志级别和过滤机制。
	- 掌握日志处理的基本流程。
- 理解工厂模式在日志系统中的应用。
	- 分析 `log_factory.h` 和 `log_factory.cc`。
	- 了解组件创建和管理机制。
	- 掌握配置加载和应用方式。
- 了解系统整体框架搭建。

- 添加日志队列
	- 项目中现在的 `压缩 & 加密 & 写入 mmap cache`，这一整个步骤会加锁保护，多线程等情况下锁会有开销，这里可以考虑使用消息队列的形式，在外部写动作和真正压缩钱，这中间加一个 `消息队列`，外部的消息同意进入消息队列中，内部使用规定线程做 `压缩 & 加密 & 写入 mmap cache` 的操作，这样可以进一步提高日志的写入速度。
 - 在日志压缩前添加一个中间队列。
- 抉择：先压缩还是先加密？
	- 先加密再压缩。
	- 先压缩再加密。
	- 比较两者性能差距。
- 总结与未来期望：完成更多优化和拓展项。
