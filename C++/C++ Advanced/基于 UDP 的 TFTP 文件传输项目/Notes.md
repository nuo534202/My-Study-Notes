<h1 style="center">基于 UDP 的 TFTP 文件传输项目</h1>

# 一、TFTP 传输模型的介绍

基于 UDP 通信的 TFTP (Trivial File Transfer Protocol，简单文件传输协议)，是一种用于在网络中进行文件传输的简单协议。TFTP 设计简单，易于实现，通常用于传输小文件或在不支持复杂协议的环境中使用。

## 1.1 协议概述

TFTP 使用的是 UDP (User Datagram Protocol，用户数据表协议) 作为传输层协议，默认端口号为 69。

TFTP 设计简单，仅支持五种格式的保温，分别是：

- RRQ (Read Request)：客户端请求读取文件
- WRQ (Write Request)：客户端请求写入文件
- DATA：数据传输报文
- ACK：确认报文
- ERROR：错误报文

## 1.2 通信流程

TFTP 的通信流程分为两个阶段：请求阶段和传输阶段

- 请求阶段
  - 客户端向服务器发送 RRQ 或者 WRQ 报文，请求读取或者写入文件，RRQ 报文包含文件名和传输模式（通常是 "netascii" 或者 "octet"），WRQ 报文类似。
  - 服务器响应：服务器受到 RRQ 或者 WRQ 之后，会分配一个新的 UDP 端口用于数据传输，并发送 ACK 进行确认（对于 WRQ）或者直接发送 DATA（对于 RRQ）最为响应。
- 传输阶段
  - 数据传输
    - 在 RRQ 请求中，服务器开始发送 DATA 报文，每个 DATA 报文包含一个块编号和一个数据段，客户端受到 DATA 报文后，发送 ACK 报文确认收到块编号。
    - 在 WRQ 请求中，客户端发送 DATA 报文，服务器发送 ACK 报文确认。
  - 块编号：每个 DATA 报文和 ACK 报文都包含一个 16 位的块编号，从 1 开始递增，块编号用于确保数据的有序传输和确认。
  - 结束传输：当传输的文件大小小于 512 字节时，DATA 报文的数据部分小于 512 字节，表示传输结束。对于 WRQ 请求，客户端发送一个小于 512 字节的 DATA 报文表示传输结束。

## 1.3 报文格式

![img1](./img/img1.png#pic_center)

从上往下

- 第一行（读写请求 RRQ 和 WRQ 格式）：操作码 1 代表 RRQ，2 代表 WRQ；文件名数据类型是字符串；第一个 0 作为文件名的结束；模式指的是通信模式（"netascii" 或者 "octet"）。
- 第二行（数据包 DATA 格式）：操作码 3 代表是 DATA 报文。
- 第三行（确认报文 ACK 格式）：操作码 4 代表是 ACK 报文，表示确认收到对应的块编号。
- 第四行（错误信息 ERROR 格式）：操作码 5 代表是 ERROR 报文。

有关错误码对应的信息：

```
0	未定义，差错错误信息
1	File Not Found
2	违反规定
3	磁盘满或者分配超出
4	非法操作
5	未知的传输 ID
6	文件已存在
7	没有该用户
```

## 1.4 传输模型

![img2](./img/img2.png#pic_center)

# 二、项目流程图

## 2.1 客户端主程序流程图

![客户端项目流程图](客户端主程序流程图.png)
